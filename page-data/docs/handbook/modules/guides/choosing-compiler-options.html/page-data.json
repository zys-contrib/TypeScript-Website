{"componentChunkName":"component---src-templates-documentation-tsx","path":"/docs/handbook/modules/guides/choosing-compiler-options.html","result":{"data":{"markdownRemark":{"id":"c062183f-cf3d-5b33-8417-920debd9e2b9","excerpt":"I’m writing an app A single tsconfig.json can only represent a single environment, both in terms of what globals are available and in terms of how modules…","html":"<h2 id=\"im-writing-an-app\" style=\"position:relative;\"><a href=\"#im-writing-an-app\" aria-label=\"im writing an app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m writing an app</h2>\n<p>A single tsconfig.json can only represent a single environment, both in terms of what globals are available and in terms of how modules behave. If your app contains server code, DOM code, web worker code, test code, and code to be shared by all of those, each of those should have its own tsconfig.json, connected with <a href=\"https://www.typescriptlang.org/docs/handbook/project-references.html#handbook-content\">project references</a>. Then, use this guide once for each tsconfig.json. For library-like projects within an app, especially ones that need to run in multiple runtime environments, use the “<a href=\"#im-writing-a-library\">I’m writing a library</a>” section.</p>\n<h3 id=\"im-using-a-bundler\" style=\"position:relative;\"><a href=\"#im-using-a-bundler\" aria-label=\"im using a bundler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m using a bundler</h3>\n<p>In addition to adopting the following settings, it’s also recommended <em>not</em> to set <code>{ \"type\": \"module\" }</code> or use <code>.mts</code> files in bundler projects for now. <a href=\"https://andrewbranch.github.io/interop-test/#synthesizing-default-exports-for-cjs-modules\">Some bundlers</a> adopt different ESM/CJS interop behavior under these circumstances, which TypeScript cannot currently analyze with <code>\"moduleResolution\": \"bundler\"</code>. See <a href=\"https://github.com/microsoft/TypeScript/issues/54102\">issue #54102</a> for more information.</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">json</div><div class='code-container'><code><div class='line'><span style=\"color: #000000\">{</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #0451A5\">\"compilerOptions\"</span><span style=\"color: #000000\">: {</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// This is not a complete template; it only</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// shows relevant module-related settings.</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Be sure to set other important options</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// like `target`, `lib`, and `strict`.</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Required</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"module\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"esnext\"</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"moduleResolution\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"bundler\"</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"esModuleInterop\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Consult your bundler’s documentation</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"customConditions\"</span><span style=\"color: #000000\">: [</span><span style=\"color: #A31515\">\"module\"</span><span style=\"color: #000000\">],</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Recommended</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"noEmit\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">, </span><span style=\"color: #008000\">// or `emitDeclarationOnly`</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"allowImportingTsExtensions\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"allowArbitraryExtensions\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"verbatimModuleSyntax\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">, </span><span style=\"color: #008000\">// or `isolatedModules`</span></div><div class='line'><span style=\"color: #000000\">  }</span></div><div class='line'><span style=\"color: #000000\">}</span></div></code></div></pre>\n<h3 id=\"im-compiling-and-running-the-outputs-in-nodejs\" style=\"position:relative;\"><a href=\"#im-compiling-and-running-the-outputs-in-nodejs\" aria-label=\"im compiling and running the outputs in nodejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m compiling and running the outputs in Node.js</h3>\n<p>Remember to set <code>\"type\": \"module\"</code> or use <code>.mts</code> files if you intend to emit ES modules.</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">json</div><div class='code-container'><code><div class='line'><span style=\"color: #000000\">{</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #0451A5\">\"compilerOptions\"</span><span style=\"color: #000000\">: {</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// This is not a complete template; it only</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// shows relevant module-related settings.</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Be sure to set other important options</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// like `target`, `lib`, and `strict`.</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Required</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"module\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"nodenext\"</span><span style=\"color: #000000\">,</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Implied by `\"module\": \"nodenext\"`:</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// \"moduleResolution\": \"nodenext\",</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// \"esModuleInterop\": true,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// \"target\": \"esnext\",</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Recommended</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"verbatimModuleSyntax\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">  }</span></div><div class='line'><span style=\"color: #000000\">}</span></div></code></div></pre>\n<h3 id=\"im-using-ts-node\" style=\"position:relative;\"><a href=\"#im-using-ts-node\" aria-label=\"im using ts node permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m using ts-node</h3>\n<p>ts-node attempts to be compatible with the same code and the same tsconfig.json settings that can be used to <a href=\"#im-compiling-and-running-the-outputs-in-node\">compile and run the JS outputs in Node.js</a>. Refer to <a href=\"https://typestrong.org/ts-node/\">ts-node documentation</a> for more details.</p>\n<h3 id=\"im-using-tsx\" style=\"position:relative;\"><a href=\"#im-using-tsx\" aria-label=\"im using tsx permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m using tsx</h3>\n<p>Whereas ts-node makes minimal modifications to Node.js’s module system by default, <a href=\"https://github.com/esbuild-kit/tsx\">tsx</a> behaves more like a bundler, allowing extensionless/index module specifiers and arbitrary mixing of ESM and CJS. Use the same settings for tsx as you <a href=\"#im-using-a-bundler\">would for a bundler</a>.</p>\n<h3 id=\"im-writing-es-modules-for-the-browser-with-no-bundler-or-module-compiler\" style=\"position:relative;\"><a href=\"#im-writing-es-modules-for-the-browser-with-no-bundler-or-module-compiler\" aria-label=\"im writing es modules for the browser with no bundler or module compiler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m writing ES modules for the browser, with no bundler or module compiler</h3>\n<p>TypeScript does not currently have options dedicated to this scenario, but you can approximate them by using a combination of the <code>nodenext</code> ESM module resolution algorithm and <code>paths</code> as a substitute for URL and import map support.</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">json</div><div class='code-container'><code><div class='line'><span style=\"color: #008000\">// tsconfig.json</span></div><div class='line'><span style=\"color: #000000\">{</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #0451A5\">\"compilerOptions\"</span><span style=\"color: #000000\">: {</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// This is not a complete template; it only</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// shows relevant module-related settings.</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Be sure to set other important options</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// like `target`, `lib`, and `strict`.</span></div><div class='line'></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// Combined with `\"type\": \"module\"` in a local package.json,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #008000\">// this enforces including file extensions on relative path imports.</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"module\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"nodenext\"</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"paths\"</span><span style=\"color: #000000\">: {</span></div><div class='line'><span style=\"color: #000000\">      </span><span style=\"color: #008000\">// Point TS to local types for remote URLs:</span></div><div class='line'><span style=\"color: #000000\">      </span><span style=\"color: #0451A5\">\"https://esm.sh/lodash@4.17.21\"</span><span style=\"color: #000000\">: [</span><span style=\"color: #A31515\">\"./node_modules/@types/lodash/index.d.ts\"</span><span style=\"color: #000000\">],</span></div><div class='line'><span style=\"color: #000000\">      </span><span style=\"color: #008000\">// Optional: point bare specifier imports to an empty file</span></div><div class='line'><span style=\"color: #000000\">      </span><span style=\"color: #008000\">// to prohibit importing from node_modules specifiers not listed here:</span></div><div class='line'><span style=\"color: #000000\">      </span><span style=\"color: #0451A5\">\"*\"</span><span style=\"color: #000000\">: [</span><span style=\"color: #A31515\">\"./empty-file.ts\"</span><span style=\"color: #000000\">]</span></div><div class='line'><span style=\"color: #000000\">    }</span></div><div class='line'><span style=\"color: #000000\">  }</span></div><div class='line'><span style=\"color: #000000\">}</span></div></code></div></pre>\n<p>This setup allows explicitly listed HTTPS imports to use locally-installed type declaration files, while erroring on imports that would normally resolve in node_modules:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">import</span><span style=\"color: #000000\"> {} </span><span style=\"color: #AF00DB\">from</span><span style=\"color: #000000\"> </span><span style=\"color: #A31515\">\"lodash\"</span><span style=\"color: #000000\">;</span></div><div class='line'><span style=\"color: #008000\">//             ^^^^^^^^</span></div><div class='line'><span style=\"color: #008000\">// File '/project/empty-file.ts' is not a module. ts(2306)</span></div></code></div></pre>\n<p>Alternatively, you can use <a href=\"https://github.com/WICG/import-maps\">import maps</a> to explicitly map a list of bare specifiers to URLs in the browser, while relying on <code>nodenext</code>’s default node_modules lookups, or on <code>paths</code>, to direct TypeScript to type declaration files for those bare specifier imports:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">html</div><div class='code-container'><code><div class='line'><span style=\"color: #800000\">&lt;script</span><span style=\"color: #000000FF\"> </span><span style=\"color: #EE0000\">type</span><span style=\"color: #000000FF\">=</span><span style=\"color: #0000FF\">\"importmap\"</span><span style=\"color: #800000\">&gt;</span></div><div class='line'><span style=\"color: #000000FF\">{</span></div><div class='line'><span style=\"color: #000000FF\">  \"imports\": {</span></div><div class='line'><span style=\"color: #000000FF\">    \"lodash\": \"https://esm.sh/lodash@4.17.21\"</span></div><div class='line'><span style=\"color: #000000FF\">  }</span></div><div class='line'><span style=\"color: #000000FF\">}</span></div><div class='line'><span style=\"color: #800000\">&lt;/script&gt;</span></div></code></div></pre>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">import</span><span style=\"color: #000000\"> {} </span><span style=\"color: #AF00DB\">from</span><span style=\"color: #000000\"> </span><span style=\"color: #A31515\">\"lodash\"</span><span style=\"color: #000000\">;</span></div><div class='line'><span style=\"color: #008000\">// Browser: https://esm.sh/lodash@4.17.21</span></div><div class='line'><span style=\"color: #008000\">// TypeScript: ./node_modules/@types/lodash/index.d.ts</span></div></code></div></pre>\n<h2 id=\"im-writing-a-library\" style=\"position:relative;\"><a href=\"#im-writing-a-library\" aria-label=\"im writing a library permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>I’m writing a library</h2>\n<!-- TODO: I might move all this to a guide/appendix on library publishing and link -->\n<p>Choosing compilation settings as a library author is a fundamentally different process from choosing settings as an app author. When writing an app, settings are chosen that reflect the runtime environment or bundler—typically a single entity with known behavior. When writing a library, you would ideally check your code under <em>all possible</em> library consumer compilation settings. Since this is impractical, you can instead use the strictest possible settings, since satisfying those tends to satisfy all others.</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">json</div><div class='code-container'><code><div class='line'><span style=\"color: #000000\">{</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #0451A5\">\"compilerOptions\"</span><span style=\"color: #000000\">: {</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"module\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"node16\"</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"target\"</span><span style=\"color: #000000\">: </span><span style=\"color: #A31515\">\"es2020\"</span><span style=\"color: #000000\">, </span><span style=\"color: #008000\">// set to the *lowest* target you support</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"strict\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"verbatimModuleSyntax\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"declaration\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"sourceMap\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span><span style=\"color: #000000\">,</span></div><div class='line'><span style=\"color: #000000\">    </span><span style=\"color: #0451A5\">\"declarationMap\"</span><span style=\"color: #000000\">: </span><span style=\"color: #0000FF\">true</span></div><div class='line'><span style=\"color: #000000\">  }</span></div><div class='line'><span style=\"color: #000000\">}</span></div></code></div></pre>\n<p>Let’s examine why we picked each of these settings:</p>\n<ul>\n<li>\n<p><strong><code>module: \"node16\"</code></strong>. When a codebase is compatible with Node.js’s module system, it almost always works in bundlers as well. If you’re using a third-party emitter to emit ESM outputs, ensure that you set <code>\"type\": \"module\"</code> in your package.json so TypeScript checks your code as ESM, which uses a stricter module resolution algorithm in Node.js than CommonJS does. As an example, let’s look at what would happen if a library were to compile with <code>\"moduleResolution\": \"bundler\"</code>:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">export</span><span style=\"color: #000000\"> </span><span style=\"color: #0000FF\">*</span><span style=\"color: #000000\"> </span><span style=\"color: #AF00DB\">from</span><span style=\"color: #000000\"> </span><span style=\"color: #A31515\">\"./utils\"</span><span style=\"color: #000000\">;</span></div></code></div></pre>\n<p>Assuming <code>./utils.ts</code> (or <code>./utils/index.ts</code>) exists, a bundler would be fine with this code, so <code>\"moduleResolution\": \"bundler\"</code> doesn’t complain. Compiled with <code>\"module\": \"esnext\"</code>, the output JavaScript for this export statement will look exactly the same as the input. If that JavaScript were published to npm, it would be usable by projects that use a bundler, but it would cause an error when run in Node.js:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class='code-container'><code><div class='line'><span style=\"color: undefined\">Error [ERR_MODULE_NOT_FOUND]: Cannot find module '.../node_modules/dependency/utils' imported from .../node_modules/dependency/index.js\nDid you mean to import ./utils.js?</span></div></code></div></pre>\n<p>On the other hand, if we had written:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">export</span><span style=\"color: #000000\"> </span><span style=\"color: #0000FF\">*</span><span style=\"color: #000000\"> </span><span style=\"color: #AF00DB\">from</span><span style=\"color: #000000\"> </span><span style=\"color: #A31515\">\"./utils.js\"</span><span style=\"color: #000000\">;</span></div></code></div></pre>\n<p>This would produce output that works both in Node.js <em>and</em> in bundlers.</p>\n<p>In short, <code>\"moduleResolution\": \"bundler\"</code> is infectious, allowing code that only works in bundlers to be produced. Likewise, <code>\"moduleResolution\": \"nodenext\"</code> is only checking that the output works in Node.js, but in most cases, module code that works in Node.js will work in other runtimes and in bundlers.</p>\n</li>\n<li>\n<p><strong><code>target: \"es2020\"</code></strong>. Setting this value to the <em>lowest</em> ECMAScript version that you intend to support ensures the emitted code will not use language features introduced in a later version. Since <code>target</code> also implies a corresponding value for <code>lib</code>, this also ensures you don’t access globals that may not be available in older environments.</p>\n</li>\n<li>\n<p><strong><code>strict: true</code></strong>. Without this, you may write type-level code that ends up in your output <code>.d.ts</code> files and errors when a consumer compiles with <code>strict</code> enabled. For example, this <code>extends</code> clause:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">export</span><span style=\"color: #000000\"> </span><span style=\"color: #0000FF\">interface</span><span style=\"color: #000000\"> </span><span style=\"color: #1C6277\">Super</span><span style=\"color: #000000\"> {</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #001080\">foo</span><span style=\"color: #000000\">: </span><span style=\"color: #1C6277\">string</span><span style=\"color: #000000\">;</span></div><div class='line'><span style=\"color: #000000\">}</span></div><div class='line'><span style=\"color: #AF00DB\">export</span><span style=\"color: #000000\"> </span><span style=\"color: #0000FF\">interface</span><span style=\"color: #000000\"> </span><span style=\"color: #1C6277\">Sub</span><span style=\"color: #000000\"> </span><span style=\"color: #0000FF\">extends</span><span style=\"color: #000000\"> </span><span style=\"color: #1C6277\">Super</span><span style=\"color: #000000\"> {</span></div><div class='line'><span style=\"color: #000000\">  </span><span style=\"color: #001080\">foo</span><span style=\"color: #000000\">: </span><span style=\"color: #1C6277\">string</span><span style=\"color: #000000\"> | </span><span style=\"color: #1C6277\">undefined</span><span style=\"color: #000000\">;</span></div><div class='line'><span style=\"color: #000000\">}</span></div></code></div></pre>\n<p>is only an error under <code>strictNullChecks</code>. On the other hand, it’s very difficult to write code that errors only when <code>strict</code> is <em>disabled</em>, so it’s highly recommended for libraries to compile with <code>strict</code>.</p>\n</li>\n<li>\n<p><strong><code>verbatimModuleSyntax: true</code></strong>. This setting protects against a few module-related pitfalls that can cause problems for library consumers. First, it prevents writing any import statements that could be interpreted ambiguously based on the user’s value of <code>esModuleInterop</code> or <code>allowSyntheticDefaultImports</code>. Previously, it was often suggested that libraries compile without <code>esModuleInterop</code>, since its use in libraries could force users to adopt it too. However, it’s also possible to write imports that only work <em>without</em> <code>esModuleInterop</code>, so neither value for the setting guarantees portability for libraries. <code>verbatimModuleSyntax</code> does provide such a guarantee.<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> Second, it prevents the use of <code>export default</code> in modules that will be emitted as CommonJS, which can require bundler users and Node.js ESM users to consume the module differently. See the appendix on <a href=\"/docs/handbook/modules/appendices/esm-cjs-interop.html#library-code-needs-special-considerations\">ESM/CJS Interop</a> for more details.</p>\n</li>\n<li>\n<p><strong><code>declaration: true</code></strong> emits type declaration files alongside the output JavaScript. This is needed for consumers of the library to have any type information.</p>\n</li>\n<li>\n<p><strong><code>sourceMap: true</code></strong> and <strong><code>declarationMap: true</code></strong> emit source maps for the output JavaScript and type declaration files, respectively. These are only useful if the library also ships its source (<code>.ts</code>) files. By shipping source maps and source files, consumers of the library will be able to debug the library code somewhat more easily. By shipping declaration maps and source files, consumers will be able to see the original TypeScript sources when they run Go To Definition on imports from the libraries. Both of these represent a tradeoff between developer experience and library size, so it’s up to you whether to include them.</p>\n</li>\n</ul>\n<h3 id=\"considerations-for-bundling-libraries\" style=\"position:relative;\"><a href=\"#considerations-for-bundling-libraries\" aria-label=\"considerations for bundling libraries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Considerations for bundling libraries</h3>\n<p>If you’re using a bundler to emit your library, then all your (non-externalized) imports will be processed by the bundler with known behavior, not by your users’ unknowable environments. In this case, you can use <code>\"module\": \"esnext\"</code> and <code>\"moduleResolution\": \"bundler\"</code>, but only with two caveats:</p>\n<ol>\n<li>\n<p>TypeScript cannot model module resolution when some files are bundled and some are externalized. When bundling libraries with dependencies, it’s common to bundle the first-party library source code into a single file, but leave imports of external dependencies as real imports in the bundled output. This essentially means module resolution is split between the bundler and the end user’s environment. To model this in TypeScript, you would want to process bundled imports with <code>\"moduleResolution\": \"bundler\"</code> and externalized imports with <code>\"moduleResolution\": \"nodenext\"</code> (or with multiple options to check that everything will work in a range of end-user environments). But TypeScript cannot be configured to use two different module resolution settings in the same compilation. As a consequence, using <code>\"moduleResolution\": \"bundler\"</code> may allow imports of externalized dependencies that would work in a bundler but are unsafe in Node.js. On the other hand, using <code>\"moduleResolution\": \"nodenext\"</code> may impose overly strict requirements on bundled imports.</p>\n</li>\n<li>\n<p>You must ensure that your declaration files get bundled as well. Recall the <a href=\"/docs/handbook/modules/theory.html#the-role-of-declaration-files\">first rule of declaration files</a>: every declaration file represents exactly one JavaScript file. If you use <code>\"moduleResolution\": \"bundler\"</code> and use a bundler to emit an ESM bundle while using <code>tsc</code> to emit many individual declaration files, your declaration files may cause errors when consumed under <code>\"module\": \"nodenext\"</code>. For example, an input file like:</p>\n<pre class=\"shiki light-plus\" style=\"background-color: #FFFFFF; color: #000000\"><div class=\"language-id\">ts</div><div class='code-container'><code><div class='line'><span style=\"color: #AF00DB\">import</span><span style=\"color: #000000\"> { </span><span style=\"color: #001080\">Component</span><span style=\"color: #000000\"> } </span><span style=\"color: #AF00DB\">from</span><span style=\"color: #000000\"> </span><span style=\"color: #A31515\">\"./extensionless-relative-import\"</span><span style=\"color: #000000\">;</span></div></code></div></pre>\n<p>will have its import erased by the JS bundler, but produce a declaration file with an identical import statement. That import statement, however, will contain an invalid module specifier in Node.js, since it’s missing a file extension. For Node.js users, TypeScript will error on the declaration file and infect types referencing <code>Component</code> with <code>any</code>, assuming the dependency will crash at runtime.</p>\n<p>If your TypeScript bundler does not produce bundled declaration files, use <code>\"moduleResolution\": \"nodenext\"</code> to ensure that the imports preserved in your declaration files will be compatible with end-users’ TypeScript settings. Even better, consider not bundling your library.</p>\n</li>\n</ol>\n<h3 id=\"notes-on-dual-emit-solutions\" style=\"position:relative;\"><a href=\"#notes-on-dual-emit-solutions\" aria-label=\"notes on dual emit solutions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Notes on dual-emit solutions</h3>\n<p>A single TypeScript compilation (whether emitting or just type checking) assumes that each input file will only produce one output file. Even if <code>tsc</code> isn’t emitting anything, the type checking it performs on imported names rely on knowledge about how the output file will behave at runtime, based on the module- and emit-related options set in the tsconfig.json. While third-party emitters are generally safe to use in combination with <code>tsc</code> type checking as long as <code>tsc</code> can be configured to understand what the other emitter will emit, any solution that emits two different sets of outputs with different module formats while only type checking once leaves (at least) one of the outputs unchecked. Because external dependencies may expose different APIs to CommonJS and ESM consumers, there’s no configuration you can use to guarantee in a single compilation that both outputs will be type-safe. In practice, most dependencies follow best practices and dual-emit outputs work. Running tests and <a href=\"https://npmjs.com/package/@arethetypeswrong/cli\">static analysis</a> against all output bundles before publishing significantly reduces the chance of a serious problem going unnoticed.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\"><code>verbatimModuleSyntax</code> can only work when the JS emitter emits the same module kind as <code>tsc</code> would given the tsconfig.json, source file extension, and package.json <code>\"type\"</code>. The option works by enforcing that the <code>import</code>/<code>require</code> written is identical to the <code>import</code>/<code>require</code> emitted. Any configuration that produces both an ESM and a CJS output from the same source file is fundamentally incompatible with <code>verbatimModuleSyntax</code>, since its whole purpose is to prevent you from writing <code>import</code> anywhere that a <code>require</code> would be emitted. <code>verbatimModuleSyntax</code> can also be defeated by configuring a third-party emitter to emit a different module kind than <code>tsc</code> would—for example, by setting <code>\"module\": \"esnext\"</code> in tsconfig.json while configuring Babel to emit CommonJS.<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","headings":[{"value":"I’m writing an app","depth":2},{"value":"I’m using a bundler","depth":3},{"value":"I’m compiling and running the outputs in Node.js","depth":3},{"value":"I’m using ts-node","depth":3},{"value":"I’m using tsx","depth":3},{"value":"I’m writing ES modules for the browser, with no bundler or module compiler","depth":3},{"value":"I’m writing a library","depth":2},{"value":"Considerations for bundling libraries","depth":3},{"value":"Notes on dual-emit solutions","depth":3}],"frontmatter":{"permalink":"/docs/handbook/modules/guides/choosing-compiler-options.html","title":"Modules - Choosing Compiler Options","disable_toc":null,"handbook":null,"oneline":"How to choose compiler options that reflect your module environment","preamble":null,"deprecated_by":null,"deprecation_redirects":null,"experimental":null}},"prev":null,"next":null},"pageContext":{"id":"3-modules---choosing-compiler-options","slug":"/docs/handbook/modules/guides/choosing-compiler-options.html","repoPath":"/packages/documentation/copy/en/modules-reference/guides/Choosing Compiler Options.md","lang":"en","modifiedTime":"2024-10-21T12:33:11.305Z"}},"staticQueryHashes":[]}